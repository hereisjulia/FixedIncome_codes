Q2_bonds <- fread("./datas/TeamAssignment2_Q2_bond.csv")
settle <- as.IDate("2023-12-15")
Q2_bonds$ttm <- as.numeric(Q2_bonds$maturity - settle)/365
freq <- 2
# get full price
accint <- NA
for (i in 1:nrow(Q2_bonds)){
accint[i] <- bond.TCF(settle, Q2_bonds$maturity[i], Q2_bonds$coupon[i], freq = 2, "ACT/ACT")$accrued
Q2_bonds$pfull[i] <- Q2_bonds$pclean[i]+accint[i]
}
bonds <- Q2_bonds[day(maturity) == 15 & month(maturity) %in% c(5,11),]
# get discount factor, then use zcb.yield to get spot rate
D <- rep(0, nrow(bonds))
D[1] <- bonds$pfull[1]/(100 + bonds$coupon[1] *100 /freq)
for (i in 2:nrow(bonds)){
pfull <- bonds$pfull[i]
coupon <- bonds$coupon[i]
D[i] <- (pfull - sum(D[1:(i-1)])*coupon*100/freq)/(100 + coupon*100/freq)
}
bonds$disfac <- D
bonds$spot_rate <- zcb.yield(bonds$disfac*100, bonds$ttm)
## plot spot_rate
ggplot(bonds)+
geom_point(aes(x = ttm, y = spot_rate))+
labs(title = "Spot rates")
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
theta <- q2a_model$coefficients
theta
parm <- q2a_model$coefficients
parm
gfun4 <- function(ttm, parm){
tmp <- parm[1] + parm[2]*ttm + parm[3]*ttm^2 + parm[4]*ttm^3 + parm[5]*ttm^4 + parm[6]*ttm^5
return(tmp)
}
ssr <- function(parm, data){
for (i in 1:nrow(data)){
cfi <- bond.TCF(settle, data$maturity[i], data$coupon[i], freq, "ACT/ACT")$cf
cf.d <- coupons.dates(settle, data$maturity[i], freq)
ttmi <- as.numeric(cf.d - settle)/365
rates <- sapply(ttmi, gfun4, parm = parm)
disfac <- 1/(1+rates/2)^(ttmi*2)
data$phat[i] <- sum(disfac*cfi)
}
ztest <- sum((data$pfull - data$phat)^2)
if (is.nan(ztest)) ztest <- 9e20
return(list(data, ztest))
}
ssr(parm, bonds)
predictions <- ssr(parm, bonds)
predictions[[1]]
bonds <- predictions[[1]]
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pclean,
act_spot_rate = bonds$spot_rate)
nonlin_reg$pred_spot_rate <- predict(q2a_model, newdata = bonds[,"ttm"])
for (i in 1:nrow(bonds)){
maturity <- bonds$maturity[i]
coupon <- bonds$coupon[i]
yield <- nonlin_reg$pred_spot_rate[i]
nonlin_reg$predict_price[i] <- bond.price(settle, maturity, coupon, freq, yield, "ACT/ACT")
}
# spot_rate plot
plot1 <- pivot_longer(nonlin_reg[,c(1,3,4)], cols = -1, names_to = "type", values_to = "spot_rate")
predictions <- ssr(parm, bonds)
bonds <- predictions[[1]]
View(bonds)
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# spot_rate plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
Q2_bonds <- fread("./datas/TeamAssignment2_Q2_bond.csv")
settle <- as.IDate("2023-12-15")
Q2_bonds$ttm <- as.numeric(Q2_bonds$maturity - settle)/365
freq <- 2
# get full price
accint <- NA
for (i in 1:nrow(Q2_bonds)){
accint[i] <- bond.TCF(settle, Q2_bonds$maturity[i], Q2_bonds$coupon[i], freq = 2, "ACT/ACT")$accrued
Q2_bonds$pfull[i] <- Q2_bonds$pclean[i]+accint[i]
}
bonds <- Q2_bonds[maturity>settle,]
# get discount factor, then use zcb.yield to get spot rate
D <- rep(0, nrow(bonds))
D[1] <- bonds$pfull[1]/(100 + bonds$coupon[1] *100 /freq)
for (i in 2:nrow(bonds)){
pfull <- bonds$pfull[i]
coupon <- bonds$coupon[i]
D[i] <- (pfull - sum(D[1:(i-1)])*coupon*100/freq)/(100 + coupon*100/freq)
}
bonds$disfac <- D
bonds$spot_rate <- zcb.yield(bonds$disfac*100, bonds$ttm)
## plot spot_rate
ggplot(bonds)+
geom_point(aes(x = ttm, y = spot_rate))+
labs(title = "Spot rates")
get_parm <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
parm <- get_parm$coefficients
parm
gfun4 <- function(ttm, parm){
tmp <- parm[1] + parm[2]*ttm + parm[3]*ttm^2 + parm[4]*ttm^3 + parm[5]*ttm^4 + parm[6]*ttm^5
return(tmp)
}
ssr <- function(parm, data){
for (i in 1:nrow(data)){
cfi <- bond.TCF(settle, data$maturity[i], data$coupon[i], freq, "ACT/ACT")$cf
cf.d <- coupons.dates(settle, data$maturity[i], freq)
ttmi <- as.numeric(cf.d - settle)/365
rates <- sapply(ttmi, gfun4, parm = parm)
disfac <- 1/(1+rates/2)^(ttmi*2)
data$phat[i] <- sum(disfac*cfi)
}
ztest <- sum((data$pfull - data$phat)^2)
if (is.nan(ztest)) ztest <- 9e20
return(list(data, ztest))
}
predictions <- ssr(parm, bonds)
bonds <- predictions[[1]]
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
parm <- q2a_model$coefficients
parm
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
View(Q2_ci)
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
parm <- q2a_model$coefficients
parm
zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm*365)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)/365
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
Q2_sp <- fread("./datas/TeamAssignment2_Q2_sp.csv")
Q2_sp[, ttm := as.numeric(maturity - settle)]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
Q2_sp[, ttm := as.numeric(maturity - settle)/365]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
Q2_bonds <- fread("./datas/TeamAssignment2_Q2_bond.csv")
settle <- as.IDate("2023-12-15")
Q2_bonds$ttm <- as.numeric(Q2_bonds$maturity - settle)/365
freq <- 2
# get full price
accint <- NA
for (i in 1:nrow(Q2_bonds)){
accint[i] <- bond.TCF(settle, Q2_bonds$maturity[i], Q2_bonds$coupon[i], freq = 2, "ACT/ACT")$accrued
Q2_bonds$pfull[i] <- Q2_bonds$pclean[i]+accint[i]
}
bonds <- Q2_bonds[maturity>settle,]
# get discount factor, then use zcb.yield to get spot rate
D <- rep(0, nrow(bonds))
D[1] <- bonds$pfull[1]/(100 + bonds$coupon[1] *100 /freq)
for (i in 2:nrow(bonds)){
pfull <- bonds$pfull[i]
coupon <- bonds$coupon[i]
D[i] <- (pfull - sum(D[1:(i-1)])*coupon*100/freq)/(100 + coupon*100/freq)
}
bonds$disfac <- D
bonds$spot_rate <- zcb.yield(bonds$disfac*100, bonds$ttm)
## plot spot_rate
ggplot(bonds)+
geom_point(aes(x = ttm, y = spot_rate))+
labs(title = "Spot rates")
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
parm <- q2a_model$coefficients
parm
gfun4 <- function(ttm, parm){
tmp <- parm[1] + parm[2]*ttm + parm[3]*ttm^2 + parm[4]*ttm^3 + parm[5]*ttm^4 + parm[6]*ttm^5
return(tmp)
}
ssr <- function(parm, data){
for (i in 1:nrow(data)){
cfi <- bond.TCF(settle, data$maturity[i], data$coupon[i], freq, "ACT/ACT")$cf
cf.d <- coupons.dates(settle, data$maturity[i], freq)
ttmi <- as.numeric(cf.d - settle)/365
rates <- sapply(ttmi, gfun4, parm = parm)
disfac <- 1/(1+rates/2)^(ttmi*2)
data$phat[i] <- sum(disfac*cfi)
}
ztest <- sum((data$pfull - data$phat)^2)
if (is.nan(ztest)) ztest <- 9e20
return(list(data, ztest))
}
predictions <- ssr(parm, bonds)
bonds <- predictions[[1]]
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)/365
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
Q2_sp <- fread("./datas/TeamAssignment2_Q2_sp.csv")
Q2_sp[, ttm := as.numeric(maturity - settle)/365]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm*365)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
parm
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)/365
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
theme_minimal()
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price")+
theme_minimal()
Q2_sp <- fread("./datas/TeamAssignment2_Q2_sp.csv")
Q2_sp[, ttm := as.numeric(maturity - settle)/365]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))
?zcb.price
??zcb.price
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price on CI strips")+
theme_minimal()
Q2_sp <- fread("./datas/TeamAssignment2_Q2_sp.csv")
Q2_sp[, ttm := as.numeric(maturity - settle)/365]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price on SP strips")+
theme_minimal()
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of Bonds")+
theme_minimal()
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of CI strips")+
theme_minimal()
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of SP strips")+
theme_minimal()
Q2_bonds <- fread("./datas/TeamAssignment2_Q2_bond.csv")
settle <- as.IDate("2023-12-15")
Q2_bonds$ttm <- as.numeric(Q2_bonds$maturity - settle)/365
freq <- 2
library(data.table)
library(jrvFinance)
library(ggplot2)
library(tidyverse)
zcb.price <- function(zcb.yield,ttm,comp.freq=2) {
return( 100/(1+zcb.yield/comp.freq)^(comp.freq*ttm) )
}
library(data.table)
library(jrvFinance)
library(ggplot2)
library(tidyverse)
zcb.price <- function(zcb.yield,ttm,comp.freq=2) {
return( 100/(1+zcb.yield/comp.freq)^(comp.freq*ttm) )
}
zcb.yield <- function(zcb.price,ttm,comp.freq=2) {
return( comp.freq * ( (100/zcb.price)^(1/(comp.freq*ttm)) - 1 ) )
}
Q2_bonds <- fread("./datas/TeamAssignment2_Q2_bond.csv")
settle <- as.IDate("2023-12-15")
Q2_bonds$ttm <- as.numeric(Q2_bonds$maturity - settle)/365
freq <- 2
# get full price
accint <- NA
for (i in 1:nrow(Q2_bonds)){
accint[i] <- bond.TCF(settle, Q2_bonds$maturity[i], Q2_bonds$coupon[i], freq = 2, "ACT/ACT")$accrued
Q2_bonds$pfull[i] <- Q2_bonds$pclean[i]+accint[i]
}
bonds <- Q2_bonds[maturity>settle,]
# get discount factor, then use zcb.yield to get spot rate
D <- rep(0, nrow(bonds))
D[1] <- bonds$pfull[1]/(100 + bonds$coupon[1] *100 /freq)
for (i in 2:nrow(bonds)){
pfull <- bonds$pfull[i]
coupon <- bonds$coupon[i]
D[i] <- (pfull - sum(D[1:(i-1)])*coupon*100/freq)/(100 + coupon*100/freq)
}
bonds$disfac <- D
bonds$spot_rate <- zcb.yield(bonds$disfac*100, bonds$ttm)
## plot spot_rate
ggplot(bonds)+
geom_point(aes(x = ttm, y = spot_rate))+
labs(title = "Spot rates")
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds)
parm <- q2a_model$coefficients
parm
predict(q2a_model, bonds$ttm)
View(bonds)
?predict
predict(q2a_model, newdata = bonds$ttm)
View(bonds)
predict(q2a_model, newdata = bonds[,"ttm"])
plot <- predict(q2a_model, newdata = bonds[,"ttm"])
View(bonds)
plot <- cbind(bonds[,"ttm"],bonds[,"spot_rate"], plot)
View(plot)
plot <- predict(q2a_model, newdata = bonds[,"ttm"])
plot <- predict(q2a_model, newdata = bonds[,"ttm"])
plot <- cbind(bonds[,"ttm"],actual = bonds[,"spot_rate"], predict = plot)
View(plot)
plot <- cbind(bonds[,"ttm"],actual = bonds$spot_rate, predict = plot)
plot <- predict(q2a_model, newdata = bonds[,"ttm"])
plot <- predict(q2a_model, newdata = bonds[,"ttm"])
plot <- cbind(bonds[,"ttm"],actual = bonds$spot_rate, predict = plot)
View(plot)
plot <- pivot_longer(plot, cols = -1, names_to = "type", values_to = "spot_rate")
ggplot(plot)+
geom_point(aes(x = ttm, y = spot_rate, color = type))+
labs(title = "Actual & Predicted price of spot rate")+
theme_minimal()
View(Q2_ci)
zcb.yield(Q2_ci$price, Q2_ci$ttm)
spot <- zcb.yield(Q2_ci$price, Q2_ci$ttm)
Q2_ci$spot <- zcb.yield(Q2_ci$price, Q2_ci$ttm)
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)/365
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
Q2_ci$spot <- zcb.yield(Q2_ci$price, Q2_ci$ttm)
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of CI strips")+
theme_minimal()
View(Q2_ci)
plot <- pivot_longer(Q2_ci[,c(3,4,6)], cols = -1, names_to = "type", values_to = "spot_rate")
ggplot(plot)+
geom_point(aes(x = ttm, y = spot_rate, color = type))+
labs(title = "Actual & Predicted price of spot rate")+
theme_minimal()
bonds1 <- bonds[day(maturity) == 15 & month(maturity) %in% c(5,11)]
bonds1 <- bonds[days(maturity) == 15 & month(maturity) %in% c(5,11)]
library(data.table)
library(data.table)
library(jrvFinance)
library(ggplot2)
library(tidyverse)
library(data.table)
library(jrvFinance)
library(ggplot2)
library(tidyverse)
bonds1 <- bonds[days(maturity) == 15 & month(maturity) %in% c(5,11)]
q2a_model <- lm(spot_rate ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = bonds1)
parm <- q2a_model$coefficients
parm
gfun4 <- function(ttm, parm){
tmp <- parm[1] + parm[2]*ttm + parm[3]*ttm^2 + parm[4]*ttm^3 + parm[5]*ttm^4 + parm[6]*ttm^5
return(tmp)
}
ssr <- function(parm, data){
for (i in 1:nrow(data)){
cfi <- bond.TCF(settle, data$maturity[i], data$coupon[i], freq, "ACT/ACT")$cf
cf.d <- coupons.dates(settle, data$maturity[i], freq)
ttmi <- as.numeric(cf.d - settle)/365
rates <- sapply(ttmi, gfun4, parm = parm)
disfac <- 1/(1+rates/2)^(ttmi*2)
data$phat[i] <- sum(disfac*cfi)
}
ztest <- sum((data$pfull - data$phat)^2)
if (is.nan(ztest)) ztest <- 9e20
return(list(data, ztest))
}
predictions <- ssr(parm, bonds)
bonds <- predictions[[1]]
nonlin_reg <- data.table(ttm = bonds$ttm,
actual_price = bonds$pfull,
predict_price = bonds$phat)
# price plot
plot1 <- pivot_longer(nonlin_reg, cols = -1, names_to = "type", values_to = "price")
ggplot(plot1)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of Bonds")+
theme_minimal()
# 2c) Use the estimated parameters to “predict” the prices of the coupon strips in the data file:
# TeamAssignment2_Q2_ci.csv. It contains the following information for US treasury securities:
Q2_ci <- fread("./datas/TeamAssignment2_Q2_ci.csv")
Q2_ci$ttm <- as.numeric(Q2_ci$maturity - settle)/365
Q2_ci$pred_spot_rate <- predict(q2a_model, newdata = Q2_ci[,"ttm"])
Q2_ci$pred_price <- zcb.price(Q2_ci$pred_spot_rate, Q2_ci$ttm)
plot <- pivot_longer(Q2_ci[,c(3,4,6)], cols = -1, names_to = "type", values_to = "spot_rate")
ggplot(plot)+
geom_point(aes(x = ttm, y = spot_rate, color = type))+
labs(title = "Actual & Predicted price of spot rate")+
theme_minimal()
plot2 <- pivot_longer(Q2_ci[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot2)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of CI strips")+
theme_minimal()
Q2_sp <- fread("./datas/TeamAssignment2_Q2_sp.csv")
Q2_sp[, ttm := as.numeric(maturity - settle)/365]
Q2_sp$pred_spot_rate <- predict(q2a_model, newdata = Q2_sp[,"ttm"])
Q2_sp$pred_price <- zcb.price(Q2_sp$pred_spot_rate, Q2_sp$ttm)
plot3 <- pivot_longer(Q2_sp[,c(2,3,5)], col = -2, names_to = "type", values_to = "price")
ggplot(plot3)+
geom_point(aes(x = ttm, y = price, color = type))+
labs(title = "Actual & Predicted price of SP strips")+
theme_minimal()
