# portfolio A using 5 and 10 yr T notes
Wa.5yr <- (target_Dmod - Q4$ModDur[5]) / (Q4$ModDur[4] - Q4$ModDur[5])
Wa.5yr
1 - Wa.5yr
Portfolio.A <- c(Wa.5yr, 1-Wa.5yr)
# Portfolio B includes 3 and 30 yr T securities
Wb.3yr <- (target_Dmod - Q4$ModDur[6]) / (Q4$ModDur[3] - Q4$ModDur[6])
Portfolio.B <- c(Wb.3yr, 1-Wb.3yr)
Portfolio.A
Portfolio.B
Q4
Conv.A <- Portfolio.A * Q4$Convexity[c(4,5)]
Conv.A <- sum(Portfolio.A * Q4$Convexity[c(4,5)])
Conv.B <- sum(Portfolio.B * Q4$Convexity[c(3,6)])
Conv.A > Conv.B
# Useful R functions
library(jrvFinance)
library(data.table)
# Useful R functions
library(jrvFinance)
library(data.table)
# define DATE() function
DATE <- function(yyyy,mm,dd) {
dte  <- as.Date(sprintf("%i-%i-%i",yyyy,mm,dd),format="%Y-%m-%d")
return(dte)
}
as.Date2 <- function(x) {
tryfmt <- c("%Y-%m-%d","%m/%d/%Y","%Y/%m/%d","%b %d,%Y")
return(as.Date(x,tryFormats=tryfmt))
}
# zero coupon price function
zcb.price <- function(zcb.yield,ttm,freq=2) {
return( 100/(1+zcb.yield/freq)^(freq*ttm) )
}
# zero coupon yield function
zcb.yield <- function(zcb.price,ttm,freq=2) {
return( freq * ( (100/zcb.price)^(1/(freq*ttm)) - 1 ) )
}
# function to calculate convexity of a coupon bond
bond.convexity <- function(settle,mature,coupon,freq=2,yield,convention,comp.freq=freq) {
z  <- as.data.frame(bond.TCF(settle,mature,coupon,freq,convention))
cf <- z$cf
t  <- z$t
r  <- yield
m  <- comp.freq
return ( 1/sum( cf / (1+r/m)^(t*m) ) * sum( t * (t+1/m) * cf / (1 + r/m)^(t*m+2) ) )
}
Z <- function(ttm){
Z <- 0.04 + 0.01 * I(log(1+ttm))
return(Z)
}
fread("./datas/cstrips.csv")
CI <- fread("./datas/cstrips.csv")
CI[, ttm := as.numeric(maturity - as.IDate("2019-11-15"))/365]
CI[, Z := Z(ttm)]
library(ggplot2)
ggplot(CI, aes(x = ttm, y = Z))+
geom_point()
?bond.duration
settle <- DATE(2019,01,01)
mature <- DATE(2024,01,01)
couponA <- 0.04
yieldA <- 0.05
bond.duration(settle, maturity, couponA, freq = 2, yieldA, "ACT/ACT", modified = TRUE, 2)
bond.duration(settle, mature, couponA, freq = 2, yieldA, "ACT/ACT", modified = TRUE, 2)
5 * (1/ZB/2)
ZB <- 0.05
5 * (1/ZB/2)
5 * (1/(1+ZB/2))
# Q5
settle <- DATE(2024,01,19)
face <- 100
# Q6
PortA <- list(Dmod = 5, Conv = 15)
PortB <- list(Dmod = 6, Conv = 16)
-PortA$Dmod * Rchange + 0.5 * PortA$Conv * Rchange^2
Rchange <- 0.015
-PortA$Dmod * Rchange + 0.5 * PortA$Conv * Rchange^2
-PortB$Dmod * Rchange + 0.5 * PortB$Conv * Rchange^2
fund * (1-repo) *repo *1/360
# Q7
fund <- 2000000
repo <- 0.05
fund * (1-repo) *repo *1/360
fund * (1-repo)
fund  *repo *1/360
fund *repo *1/360
settle <- DATE(2024,01,19)
mature <- DATE(2024,12,26)
# Q8
face <- 1000000
BDR <- 0.0525
d <- as.numeric(mature - settle)
face * (1 - BDR * d/360)
# Q11
target <- 5
Da <- 3.4
Db <- 7.2
Wa <- (target - Db)/(Da - Db)
Wa
1-Wa
#----------------------------------------------------
# start question 12
fread("./datas/midterm/midterm_Q2_61.csv")
#----------------------------------------------------
# start question 12
Q12 <- fread("./datas/midterm/midterm_Q2_61.csv")
settle <- DATE(2024,01,19)
#----------------------------------------------------
# start question 13
Q12
bond.price(settle, Q12$maturity, Q12$coupon, freq =2, Q12$yield, "ACT/ACT", 2)
pclean <- bond.price(settle, Q12$maturity, Q12$coupon, freq =2, Q12$yield, "ACT/ACT", 2)
bond.TCF(settle, Q12$maturity, Q12$coupon, 2, "ACT/ACT")
bond.TCF(settle, Q12$maturity, Q12$coupon, 2, "ACT/ACT")$accrued
accint <- bond.TCF(settle, Q12$maturity, Q12$coupon, 2, "ACT/ACT")$accrued
pfull <- pclean + accint
pfull
# answer:
pfull
# answer:
round(pfull, 4)
Q12
# start question 14
bond.convexity(settle, Q12$maturity, Q12$coupon,
freq = 2, Q12$yield, "ACT/ACT", 2)
# start question 14
bond.convexity(settle, Q12$maturity, Q12$coupon,
freq = 2, Q12$yield, "ACT/ACT", 2)
# start question 14
convexity <- bond.convexity(settle, Q12$maturity, Q12$coupon,
freq = 2, Q12$yield, "ACT/ACT", 2)
# answer:
convexity
# answer:
round(convexity, 2)
# start question 15
ci <- fread("./datas/midterm/midterm_ci.csv")
sp <- fread("./datas/midterm/midterm_sp.csv")
settle <- DATE(2024,01,19)
Q12
?coupons.dates
Q15 <- data.table(date = coupons.dates(settle, Q12$maturity, freq = 2))
N <- nrow(Q15)
face <- 100
Q15$coupon <- face*Q12$coupon
View(Q15)
Q15[, principal := c(rep(0, N-1), face)]
View(Q15)
ci
merge(Q15, ci, by.x = date, by.y = maturity, all.x = TRUE)
merge(Q15, ci, by.x = "date", by.y = "maturity", all.x = TRUE)
Q15 <- merge(Q15, ci, by.x = "date", by.y = "maturity", all.x = TRUE)
Q15 <- merge(Q15, sp, by.x = "date", by.y = "maturity", all.x = TRUE)
View(Q15)
Q15$coupon * Q15$ci_pbid
sum(Q15$coupon * Q15$ci_pbid)
sum(Q15$coupon * Q15$ci_pbid/100)
sum(Q15$coupon * Q15$ci_pbid/100) + sum(Q15$principal * Q15$sp_pbid)
sum(Q15$principal * Q15$sp_pbid)
sum(Q15$coupon * Q15$ci_pbid/100) + sum(Q15$principal[N] * Q15$sp_pbid[N])
sum(Q15$coupon * Q15$ci_pbid/100) + sum(Q15$principal[N] * Q15$sp_pbid[N]/100)
arb.bid <- sum(Q15$coupon * Q15$ci_pbid/100) + sum(Q15$principal[N] * Q15$sp_pbid[N]/100)
# answer:
round(arb.bid, 4)
# start question 16
fread("./datas/midterm/midterm_Q3.csv")
# start question 16
Q16fread("./datas/midterm/midterm_Q3.csv")
# start question 16
Q16 <- fread("./datas/midterm/midterm_Q3.csv")
freq <- 2
settle <- DATE(2024,01,19)
Q16
bond.price(settle, Q16$maturity, Q16$coupon, freq, Q16$yield, "ACT/ACT", freq)
Q16
price <- NA
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
yield <- Q16$yield[i]
price[i] <- bond.price(settle, mature, coupon, freq, yield, "ACT/ACT", freq)
}
price
Q16$market.value <- Q16$face * price
sum(Q16$market.value)
port.market.value <- sum(Q16$market.value)
# answer:
port.market.value
sum(Q16$face)
Q16$market.value <- Q16$face * price /100
port.market.value <- sum(Q16$market.value)
# answer:
port.market.value
# answer:
round(port.market.value)
?bond.duration
# start question 17
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
yield <- Q16$yield[i]
Q16$Dmod[i] <- bond.duration(settle, mature, coupon, freq, yield, "ACT/ACT", modified = TRUE, freq)
}
View(Q16)
Q16$market.value/port.market.value
sum(Q16$market.value/port.market.value)
Q16$market.value/port.market.value
(Q16$market.value/port.market.value * Q16$Dmod)
sum(Q16$market.value/port.market.value * Q16$Dmod)
port.dmod <- sum(Q16$market.value/port.market.value * Q16$Dmod)
# answer:
port.dmod
# answer:
round(port.dmod, 4)
# answer:
round(port.dmod, 3)
# start question 18
CFs <- NA
?coupons.dates
?bond.TCF
# start question 18
CFs <- NA
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
df <- data.table(date = coupons.dates(settle, mature, freq),
cf = bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf)
rbind(Cfs, df)
}
rbind(CFs, df)
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
df <- data.table(date = coupons.dates(settle, mature, freq),
cf = bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf)
rbind(CFs, df)
}
# start question 18
CFs <- data.table()
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
df <- data.table(date = coupons.dates(settle, mature, freq),
cf = bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf)
rbind(CFs, df)
}
View(CFs)
Q16
Q16$pclean <- price
Q16
# start question 18
accint <- NA
# start question 18
accint <- NA
?bond.TCF
# start question 18
accint <- NA
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
yield <- Q16$yield[i]
accint[i] <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$accrued
}
Q16$pfull <- Q16$pclean + accint
accint
Q16$pfull <- Q16$pclean + accint
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (i in 2:nrow(Q16)) {
cumdf <- sum(Q16$disfac[1:i-1])
Q16$disfac[i] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
}
View(Q16)
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (i in 2:nrow(Q16)) {
cumdf <- sum(disfac[1:i-1])
disfac[i] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
}
disfac
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (i in 2:length(disfac)) {
cumdf <- sum(disfac[1:i-1])
disfac[i] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
}
disfac
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (i in 2:length(date)) {
cumdf <- sum(disfac[1:i-1])
disfac[i] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
}
dasfac
disfac
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (j in 2:length(date)) {
cumdf <- sum(disfac[1:j-1])
disfac[j] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
}
disfac
cf
cf*disfac
sum(cf*disfac)
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (j in 2:length(date)) {
cumdf <- sum(disfac[1:j-1])
disfac[j] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
Q16$cf.pv <- sum(cf *disfac)
}
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (j in 2:length(date)) {
cumdf <- sum(disfac[1:j-1])
disfac[j] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
Q16$cf.pv[i] <- sum(cf *disfac)
}
View(Q16)
bondsCF <- list()
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (j in 2:length(date)) {
cumdf <- sum(disfac[1:j-1])
disfac[j] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
bondsCF[i] <- data.table(date, cf, disfac)
Q16$cf.pv[i] <- sum(cf *disfac)
}
for (i in 1:nrow(Q16)){
mature <- Q16$maturity[i]
coupon <- Q16$coupon[i]
date <- coupons.dates(settle, mature, freq)
cf <- bond.TCF(settle, mature, coupon, freq, "ACT/ACT")$cf
disfac <- rep(1, length(date))
disfac[1] <- Q16$pfull[1]/(100+Q16$coupon[1]*100/2)
for (j in 2:length(date)) {
cumdf <- sum(disfac[1:j-1])
disfac[j] <- ( Q16$pfull[i] - Q16$coupon[i]*100/2 * cumdf ) /
(100 + Q16$coupon[i]*100/2 )
}
bondsCF[[i]] <- data.table(date, cf, disfac)
Q16$cf.pv[i] <- sum(cf *disfac)
}
bondsCF
length(bondsCF)
Q16$cf.pv/port.market.value
sum(Q16$cf.pv)/port.market.value
YTM <- sum(Q16$cf.pv)/port.market.value
# answer:
YTM
# answer:
round(YTM, 4)
ci
settle <- DATE(2024,01,19)
ci[, ttm := as.numeric(maturity - settle)/365]
ci[, maturity := DATE(maturity)]
ci[, maturity := as.DATE2(maturity)]
ci[, maturity := as.Date2(maturity)]
ci
settle <- DATE(2024,01,19)
ci[, ttm := as.numeric(maturity - settle)/365]
ci
ci[, spot := zcb.yield(ci_pmid, ttm)]
Y.reg <- lm(spot ~ ttm + ttm^2 + ttm^3 + ttm^4 + ttm^5, data = ci)
Y.reg$coefficients
Y.reg <- lm(spot ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = ci)
Y.reg$coefficients
Y.reg
summary(Y.reg)
a <- summary(Y.reg)
a$r.squared
# answer:
a$adj.r.squared
summary(Y.reg)$adj.r.squared
adj.r2 <- summary(Y.reg)$adj.r.squared
# answer:
round(adj.r2, 4)
# start question 20
sp <- fread("./datas/midterm/midterm_sp.csv")
settle <- DATE(2024,01,19)
sp[, maturity := as.Date2(maturity)]
sp[, ttm := as.numeric(maturity - settle)/365]
sp[, spot := zcb.yield(sp_pmid, ttm)]
# start question 19
ci <- fread("./datas/midterm/midterm_ci.csv")
settle <- DATE(2024,01,19)
ci[, maturity := as.Date2(maturity)]
ci[, ttm := as.numeric(maturity - settle)/365]
ci[, spot := zcb.yield(ci_pmid, ttm)]
Y.reg.ci <- lm(spot ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = ci)
adj.r2.ci <- summary(Y.reg.ci)$adj.r.squared
# answer:
round(adj.r2.ci, 4)
Y.reg.sp <- lm(spot ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = ci)
Y.reg.sp <- lm(spot ~ ttm + I(ttm^2) + I(ttm^3) + I(ttm^4) + I(ttm^5), data = sp)
summary(Y.reg.sp)
summary(Y.reg.sp)$adj.r.squared
adj.r2.sp <- summary(Y.reg.sp)$adj.r.squared
# answer:
adj.r2.sp
# answer:
round(adj.r2.sp, 4)
# start question 21
mid.61 <- fread("./datas/midterm/midterm_Q2_61.csv")
# start question 21
Q12
# start question 21
mid.61 <- fread("./datas/midterm/midterm_Q2_61.csv")
settle <- DATE(2024,01,19)
date <- coupons.dates(settle, mid.61$maturity, freq)
CFs <- data.table( date = coupons.dates(settle, mid.61$maturity, freq))
face <- 100
CFs[, coupon := face * coupon]
View(CFs)
N <- nrow(CFs)
CFs[, principal := c(rep(0, N-1), face)]
View(CFs)
CFs[, ttm := as.numeric(date - settle)/365]
View(CFs)
# start question 21
mid.61 <- fread("./datas/midterm/midterm_Q2_61.csv")
settle <- DATE(2024,01,19)
face <- 100
CFs <- data.table( date = coupons.dates(settle, mid.61$maturity, freq))
N <- nrow(CFs)
CFs[, ttm := as.numeric(date - settle)/365]
CFs[, coupon := face * coupon]
CFs[, principal := c(rep(0, N-1), face)]
CFs$ci_spot <- predict(Y.reg.ci, newdata = CFs$ttm)
CFs$ci_spot <- predict(Y.reg.ci, newdata = CFs[,"ttm"])
CFs$sp_spot <- predict(Y.reg.sp, newdata = CFs[,"ttm"])
CFs[, ci.pv := zcb.price(ci_spot, ttm, freq)]
View(CFs)
CFs[, ci.pv := zcb.price(ci_spot, ttm, freq)/100 * coupon]
View(CFs)
CFs[, sp.pv := zcb.price(sp_spot, ttm, freq)/100 * principal]
sum(CFs$ci.pv)
sum(CFs$ci.pv) + sum(CFs$sp.pv)
View(CFs)
sum(CFs$ci.pv) + sum(CFs$sp.pv)
PV.61 <- sum(CFs$ci.pv) + sum(CFs$sp.pv)
# answer:
PV.61
# answer:
round(PV.61, 4)
ggplot(CI, aes(x = ttm, y = Z))+
geom_point()
autoplot()
librar(ggplot2)
library(ggplot2)
autoplot(tr)
ts
5300*12
6000*12
