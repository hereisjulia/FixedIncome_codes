---
title: "Fixed Income Assignment1"
author: "Julia"
date: "2024-01-23"
output: html_document
---

```{r}
library(readr)
library(ggplot2)
library(lubridate)
library(tidyverse)
```

```{r}
Q1data <- read_csv("TeamAssignment1_Q1.csv")
Q2STRIPS <- read_csv("TeamAssignment1_Q2_strips.csv")
Q2Bonds <- read_csv("TeamAssignment1_Q2_bonds.csv")
Q3data <- read_csv("TeamAssignment1_Q3.csv")
```

# Q3
```{r}
settlement <- as.Date("2023-12-15")

# use the coupon stips only for discount rate
Q2STRIPS_ci <- filter(Q2STRIPS, type == "ci")
Q2STRIPS_ci$price <-  (Q2STRIPS_ci$pbid + Q2STRIPS_ci$pask)/2
```

```{r}
## Discount Factor
Q2STRIPS_ci$discount <- Q2STRIPS_ci$price/100
```

## Interporation
```{r}
newttm <- as.numeric((Q3data$Date - settlement)/365)

cubic_spline <- as.data.frame(spline(as.numeric(ttm), 
       Q2STRIPS_ci$discount, 
       xout = newttm,
       method = "natural"))

Q3data$Discount <- cubic_spline$y
```

```{r}
### plot the interporation
names(cubic_spline) <- c("ttm", "discount")
cubic_spline$type <- "interporation"
interporation <- data.frame(
  ttm = as.numeric(ttm),
  discount = Q2STRIPS_ci$discount,
  type = "origin"
)
interporation <- rbind(interporation,cubic_spline)

ggplot(interporation)+
  geom_point(aes(x = ttm, y = discount, color = type))+
  labs(title = "Cubic spline on discount factors")+
  theme_minimal()
```

## 3a 
Which payout option, A or B, has the highest value?
```{r}
# single payment of $79,000,000 on 2023-12-15
optionB_value <- 79000000
optionA_value <- sum(Q3data$Amount * Q3data$Discount)
print(c(optionA_value, optionB_value))
```
> Payout option A has the highest value


## 3b
Suppose Option A is the only payout option. Discuss how the lottery winner can convert the thirty payments into a single payment using coupon STRIPS for settlement on 2023-12-15. For the purpose of part 3b, assume that the lottery winner can buy or sell the coupon STRIPS in the TeamAssignment1_Q3_strips.csv file without any restrictions. How much can the lottery winner receive from selling coupon STRIPS?

```{r}

```


## 3c 
Suppose Option A is the only payout option. Discuss how the lotteryâ€™s payment department can use coupon STRIPS to fund the thirty payments. For the purpose of part 3c, assume that the payment department can buy or sell the coupon STRIPS in the TeamAssignment1_Q3_strips.csv file without any restrictions. How much does the payment department need to fund the payments in Option A using coupon STRIPS?

we'll going to use the ask price
```{r}
#2024-2052 every may 15
strips_3c <- filter(Q2STRIPS_ci, maturity > "2024-02-15" & maturity < "2052-06-30" & month(maturity) == 5)
PV <- Q3data$Amount * Q3data$Discount
number_buy_3c <- PV/strips_3c$price

print(paste("they spend", sum(number_buy_3c*strips_3c$pask) - sum(PV), "more than the lottery PV"))

print(paste("the payment department need to fund", sum(number_buy_3c*strips_3c$pask)))
```







## spot rate
Calculate the spot rate
Z(t) = Annualized interest rate
Z(t) = 2 * ((100/P)^(1/2t) - 1)

```{r}
spot_rate <- function(price, ttm, comp.freq = 4){
  ttm <- as.numeric(ttm)
  return(comp.freq * ( (100/price)^(1/comp.freq/ttm) - 1 ) )
}

price <- Q2STRIPS_ci$price
ttm <- (Q2STRIPS_ci$maturity - settlement)/365

Q2STRIPS_ci$spote_rate <- spot_rate(price, ttm)
```

